"use strict";var app=angular.module("bookmarkApp",["ui.router"]);app.constant("API",{url:"https://aleksey-nicholas-bookmarks.herokuapp.com"}),app.config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/"),t.state("home",{url:"/",templateUrl:"partials/home.html",controller:"homeCtrl"}).state("tags",{url:"/tags",templateUrl:"partials/tags.html",controller:"tagsCtrl"}).state("tag",{url:"/tag/:id",templateUrl:"partials/tag.html",controller:"tagCtrl"}).state("edit",{url:"/link/:id",templateUrl:"partials/edit.html",controller:"editCtrl"}).state("new",{url:"/new",templateUrl:"partials/new.html",controller:"newCtrl"})}]),app.controller("homeCtrl",["$scope","$http","API",function(t,e,n){t.bookmarks=[],e.get(n.url+"/links").then(function(e){console.log("GET links successful:",e),t.bookmarks=e.data})["catch"](function(t){console.error(t)}),t.edit=function(t){console.log(event.target);var e=$(event.target),n=$('<input class="fld">');n.val(t.name),n.width(e.width()),n.height(e.height());var o=parseFloat(e.css("padding-top")),l=parseFloat(e.css("padding-left")),a=e.position();n.css("top",a.top+o),n.css("left",a.left+l),e.append(n),n.focus(),n.select()},t.key=function(){if(console.log(event.which),13===event.which){var t=$(event.target).val();$(event.target).parent().text(t+", "),$(event.target).remove(),console.log(t)}else 27===event.which&&$(event.target).remove()}}]),app.controller("newCtrl",["$scope","$http","API","tagService","$state",function(t,e,n,o,l){t.submit=function(){console.log("$scope.titleInput:",t.titleInput);var o=t.titleInput,a=t.urlInput,i=t.tagsInput.split(",").map(function(t){return t.trim()});e.post(n.url+"/links",{title:o,url:a,tags:i}).then(function(t){console.log("success:",t),l.go("home")})["catch"](function(t){console.error(t)})}}]),app.service("tagService",["$http","API",function(t,e){this.initialized=!1,this.tags=[],this.init=function(n){this.initialized===!1?(self=this,t.get(e.url+"/tags").then(function(t){console.log("GET tags successful:",t),self.tags=t.data,self.initialized=!0,n(self.tags)})["catch"](function(t){console.error(t)})):n(this.tags)},this.findTag=function(t,e){this.init(function(n){for(var o=0;o<n.length;++o)n[o]._id===t&&e(n[o])})},this.findTagByName=function(t,e){this.init(function(n){for(var o=0;o<n.length;++o)n[o].name===t&&e(n[o])})}}]),app.controller("tagCtrl",["$scope","$stateParams","$http","API","tagService",function(t,e,n,o,l){t.tag,t.init=function(){l.findTag(e.id,function(e){t.tag=e,console.log(e),t.nameInput=e.name})},t.submit=function(){t.tag.name=t.nameInput,console.log("tag: ",t.tag),n.put(o.url+"/tags",t.tag).then(function(t){console.log("PUT tag successful:",t)})["catch"](function(t){console.error(t)})}}]),app.controller("tagsCtrl",["$scope","$http","API","tagService","$state",function(t,e,n,o,l){t.tags=[],t.init=function(){o.init(function(e){t.tags=e})},t["delete"]=function(o,l){e["delete"](n.url+"/tags/"+o).then(function(e){console.log("DELETE tag successful:",e),t.tags.splice(l,1)})["catch"](function(t){console.error(t)})},t.edit=function(t){l.go("tag",{id:t})}}]);